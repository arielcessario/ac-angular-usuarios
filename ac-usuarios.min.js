(function(){var a=document.getElementsByTagName("script");var c=a[a.length-1].src;if(c.length==0){c=window.installPath+"/ac-angular-usuarios/includes/ac-usuarios.php"}angular.module("acUsuarios",[]).config(["$routeProvider","jwtInterceptorProvider","$httpProvider",function(h,g,i){g.tokenGetter=function(j){return j.get(window.appName)};i.interceptors.push("jwtInterceptor")}]).run(function(g,i,j,k,h){g.$on("$routeChangeStart",function(l,m){if(m&&m.data&&m.data.requiresLogin){if(!i.get(window.appName)){l.preventDefault();k.path(h.loginPath)}}})}).factory("UserService",f).service("UserVars",b).component("UserControl",d);function d(){return{templateUrl:"ac-angular-usuarios.html",controller:e,bindings:{hero:"<",onDelete:"&",onUpdate:"&"}}}e.$inject=[];function e(){}f.$inject=["$http","$cookieStore","store","UserVars","$cacheFactory","AcUtils","jwtHelper","auth"];function f(x,G,h,F,n,g,C,t){var k={};var l=c.replace("ac-usuarios.js","/includes/ac-usuarios.php");k.getLogged=s;k.getFromToken=i;k.setLogged=y;k.checkLastLogin=E;k.create=r;k.createFromSocial=u;k.remove=D;k.update=J;k.get=O;k.getDeudores=o;k.getDeudorById=m;k.getById=M;k.getByParams=w;k.login=K;k.loginSocial=L;k.loginFacebook=v;k.loginGoogle=p;k.logout=z;k.userExist=A;k.forgotPassword=q;k.changePassword=Q;k.goToPagina=B;k.next=j;k.prev=H;return k;function m(S,R){o(function(U){var T=U.filter(function(W,V,X){return S=W.usuario_id})[0];R(T)})}function o(R){return x.post(l,{"function":"getDeudores"}).success(function(S){R(S)}).error(function(S){R(S)})}function w(T,R,S,U){O(function(V){g.getByParams(T,R,S,V,U)})}function D(R,S){return x.post(l,{"function":"remove",usuario_id:R}).success(function(T){if(T!=="false"){F.clearCache=true;S(T)}}).error(function(T){S(T)})}function O(U){var R=l+"?function=get";var T=n.get("$http");var S=[];if(T.get(R)!=undefined){if(F.clearCache){T.remove(R)}else{S=T.get(R);U(S);return}}return x.get(R,{cache:true}).success(function(V){T.put(R,V);F.clearCache=false;F.paginas=(V.length%F.paginacion==0)?parseInt(V.length/F.paginacion):parseInt(V.length/F.paginacion)+1;U(V)}).error(function(V){U(V);F.clearCache=false})}function M(S,R){O(function(U){var T=U.filter(function(W,V,X){return W.usuario_id==S})[0];R(T)})}function E(){}function A(R,S){return x.post(l,{"function":"userExist",mail:R}).success(function(T){S(T)}).error(function(T){})}function z(R){h.remove(window.appName);G.remove(window.appName);F.clearCache=true;if(R!=undefined){R()}}function K(S,T,R,U){return x.post(l,{"function":"login",mail:S,password:T,sucursal_id:R}).success(function(V){if(V!=-1){G.put(window.appName,V.user);h.set(window.appName,V.token)}U(V)}).error(function(V){U(V)})}function L(R,S){x.post(l,{"function":"loginSocial",token:S,user:JSON.stringify(R)}).success(function(T){if(T!=-1){G.put(window.appName,T.user);h.set(window.appName,T.token)}I(T)}).error(function(T){I(T)})}var I=function(R){};function v(R){I=R;t.signin({popup:true,connections:["facebook"],scope:"openid name email"},P,N)}function p(R){I=R;t.signin({popup:true,connections:["google-oauth2"],scope:"openid name email"},P,N)}function P(S,R){A(S.email,function(U){if(U>0){var T={mail:S.email};x.post(l,{"function":"loginSocial",token:R,user:JSON.stringify(T)}).success(function(V){if(V!=-1){G.put(window.appName,V.user);h.set(window.appName,V.token)}I(V)}).error(function(V){I(V)})}else{F.user_social=S;F.token_social=R;I(U)}})}function N(R){I(R)}function u(R,S){return x.post(l,{"function":"create",user:JSON.stringify(R)}).success(function(T){F.clearCache=true;S(T)}).error(function(T){F.clearCache=true;S(T)})}function r(R,S){return x.post(l,{"function":"create",user:JSON.stringify(R)}).success(function(T){F.clearCache=true;S(T)}).error(function(T){F.clearCache=true;S(T)})}function s(){var R=G.get(window.appName);if(R!==undefined){return R}else{return false}}function i(){var R=h.get(window.appName);if(R!==undefined&&R!==null){return C.decodeToken(R)}else{return false}}function y(R){G.put(window.appName,R)}function Q(T,S,R,U){return x.post(l,{"function":"changePassword",usuario_id:T,pass_old:S,pass_new:R}).success(function(V){F.clearCache=true;U(V)}).error(function(V){U(V)})}function J(R,S){return x.post(l,{"function":"update",user:JSON.stringify(R)}).success(function(T){F.clearCache=true;S(T)}).error(function(T){S(T)})}function q(R,S){return x.post(l,{"function":"forgotPassword",email:R}).success(function(T){S(T)}).error(function(T){S(T)})}function B(R){if(isNaN(R)||R<1){F.pagina=1;return F}if(R>F.paginas){F.pagina=F.paginas;return F}F.pagina=R-1;F.start=F.pagina*F.paginacion;return F}function j(){if(F.pagina+1>F.paginas){return F}F.start=(F.pagina*F.paginacion);F.pagina=F.pagina+1;return F}function H(){if(F.pagina-2<0){return F}F.start=(F.pagina-2)*F.paginacion;F.pagina=F.pagina-1;return F}}b.$inject=[];function b(){this.paginas=1;this.pagina=1;this.paginacion=10;this.start=0;this.user_social={};this.token_social="";this.clearCache=true;this.loginPath="/login"}})();